#    Bio Bot (Telegram bot for managing the @Bio_Chain_2)
#    Copyright (C) 2019 Hackintosh Five

#    This program is free software: you can redistribute it and/or modify
#    it under the terms of the GNU Affero General Public License as
#    published by the Free Software Foundation, either version 3 of the
#    License, or (at your option) any later version.

#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU Affero General Public License for more details.

#    You should have received a copy of the GNU Affero General Public License
#    along with this program.  If not, see <https://www.gnu.org/licenses/>.

from abc import abstractmethod, ABC
import logging

import platform
if platform == "CPython":
    import regex
    USERNAME_REGEX = regex.compile(r'(?<!\pL|\pN|_)@([a-z](?:_(?!_)|[a-z0-9]){2,30}[a-z0-9]|gif|pic|vid)(?!\pL|\pN|_)', regex.I | regex.V1)
else:
    import re
    # generated by pasting the above regex into generate_regex.py
    USERNAME_REGEX = re.compile('(?<![A-Za-zÂªÂµÂºÃ€-Ã–Ã˜-Ã¶Ã¸-ËË†-Ë‘Ë -Ë¤Ë¬Ë®Í°-Í´Í¶Í·Íº-Í½Í¿Î†Îˆ-ÎŠÎŒÎŽ-Î¡Î£-ÏµÏ·-ÒÒŠ-Ô¯Ô±-Õ–Õ™Õ -Öˆ×-×ª×¯-×²Ø -ÙŠÙ®Ù¯Ù±-Û“Û•Û¥Û¦Û®Û¯Ûº-Û¼Û¿ÜÜ’-Ü¯Ý-Þ¥Þ±ßŠ-ßªß´ßµßºà €-à •à šà ¤à ¨à¡€-à¡˜à¡ -à¡ª\u0870-\u0887\u0889-\u088eà¢ -\u08c9à¤„-à¤¹à¤½à¥à¥˜-à¥¡à¥±-à¦€à¦…-à¦Œà¦à¦à¦“-à¦¨à¦ª-à¦°à¦²à¦¶-à¦¹à¦½à§Žà§œà§à§Ÿ-à§¡à§°à§±à§¼à¨…-à¨Šà¨à¨à¨“-à¨¨à¨ª-à¨°à¨²à¨³à¨µà¨¶à¨¸à¨¹à©™-à©œà©žà©²-à©´àª…-àªàª-àª‘àª“-àª¨àªª-àª°àª²àª³àªµ-àª¹àª½à«à« à«¡à«¹à¬…-à¬Œà¬à¬à¬“-à¬¨à¬ª-à¬°à¬²à¬³à¬µ-à¬¹à¬½à­œà­à­Ÿ-à­¡à­±à®ƒà®…-à®Šà®Ž-à®à®’-à®•à®™à®šà®œà®žà®Ÿà®£à®¤à®¨-à®ªà®®-à®¹à¯à°…-à°Œà°Ž-à°à°’-à°¨à°ª-à°¹à°½à±˜-à±š\u0c5dà± à±¡à²€à²…-à²Œà²Ž-à²à²’-à²¨à²ª-à²³à²µ-à²¹à²½\u0cddà³žà³ à³¡à³±à³²à´„-à´Œà´Ž-à´à´’-à´ºà´½àµŽàµ”-àµ–àµŸ-àµ¡àµº-àµ¿à¶…-à¶–à¶š-à¶±à¶³-à¶»à¶½à·€-à·†à¸-à¸°à¸²à¸³à¹€-à¹†àºàº‚àº„àº†-àºŠàºŒ-àº£àº¥àº§-àº°àº²àº³àº½à»€-à»„à»†à»œ-à»Ÿà¼€à½€-à½‡à½‰-à½¬à¾ˆ-à¾Œá€€-á€ªá€¿á-á•áš-áá¡á¥á¦á®-á°áµ-á‚á‚Žá‚ -áƒ…áƒ‡áƒáƒ-áƒºáƒ¼-á‰ˆá‰Š-á‰á‰-á‰–á‰˜á‰š-á‰á‰ -áŠˆáŠŠ-áŠáŠ-áŠ°áŠ²-áŠµáŠ¸-áŠ¾á‹€á‹‚-á‹…á‹ˆ-á‹–á‹˜-áŒáŒ’-áŒ•áŒ˜-ášáŽ€-áŽáŽ -áµá¸-á½á-á™¬á™¯-á™¿áš-áššáš -á›ªá›±-á›¸áœ€-áœ‘\u171f-áœ±á€-á‘á -á¬á®-á°áž€-áž³áŸ—áŸœá  -á¡¸á¢€-á¢„á¢‡-á¢¨á¢ªá¢°-á£µá¤€-á¤žá¥-á¥­á¥°-á¥´á¦€-á¦«á¦°-á§‰á¨€-á¨–á¨ -á©”áª§á¬…-á¬³á­…-\u1b4cá®ƒ-á® á®®á®¯á®º-á¯¥á°€-á°£á±-á±á±š-á±½á²€-á²ˆá²-á²ºá²½-á²¿á³©-á³¬á³®-á³³á³µá³¶á³ºá´€-á¶¿á¸€-á¼•á¼˜-á¼á¼ -á½…á½ˆ-á½á½-á½—á½™á½›á½á½Ÿ-á½½á¾€-á¾´á¾¶-á¾¼á¾¾á¿‚-á¿„á¿†-á¿Œá¿-á¿“á¿–-á¿›á¿ -á¿¬á¿²-á¿´á¿¶-á¿¼â±â¿â‚-â‚œâ„‚â„‡â„Š-â„“â„•â„™-â„â„¤â„¦â„¨â„ª-â„­â„¯-â„¹â„¼-â„¿â……-â…‰â…Žâ†ƒâ†„â°€-â³¤â³«-â³®â³²â³³â´€-â´¥â´§â´­â´°-âµ§âµ¯â¶€-â¶–â¶ -â¶¦â¶¨-â¶®â¶°-â¶¶â¶¸-â¶¾â·€-â·†â·ˆ-â·Žâ·-â·–â·˜-â·žâ¸¯ã€…ã€†ã€±-ã€µã€»ã€¼ã-ã‚–ã‚-ã‚Ÿã‚¡-ãƒºãƒ¼-ãƒ¿ã„…-ã„¯ã„±-ã†Žã† -ã†¿ã‡°-ã‡¿ã€-ä¶¿ä¸€-ê’Œê“-ê“½ê”€-ê˜Œê˜-ê˜Ÿê˜ªê˜«ê™€-ê™®ê™¿-êšêš -ê›¥êœ—-êœŸêœ¢-êžˆêž‹-êŸŠ\ua7d0\ua7d1\ua7d3\ua7d5-\ua7d9\ua7f2-ê ê ƒ-ê …ê ‡-ê Šê Œ-ê ¢ê¡€-ê¡³ê¢‚-ê¢³ê£²-ê£·ê£»ê£½ê£¾ê¤Š-ê¤¥ê¤°-ê¥†ê¥ -ê¥¼ê¦„-ê¦²ê§ê§ -ê§¤ê§¦-ê§¯ê§º-ê§¾ê¨€-ê¨¨ê©€-ê©‚ê©„-ê©‹ê© -ê©¶ê©ºê©¾-êª¯êª±êªµêª¶êª¹-êª½ê«€ê«‚ê«›-ê«ê« -ê«ªê«²-ê«´ê¬-ê¬†ê¬‰-ê¬Žê¬‘-ê¬–ê¬ -ê¬¦ê¬¨-ê¬®ê¬°-ê­šê­œ-ê­©ê­°-ê¯¢ê°€-íž£íž°-íŸ†íŸ‹-íŸ»ï¤€-ï©­ï©°-ï«™ï¬€-ï¬†ï¬“-ï¬—ï¬ï¬Ÿ-ï¬¨ï¬ª-ï¬¶ï¬¸-ï¬¼ï¬¾ï­€ï­ï­ƒï­„ï­†-ï®±ï¯“-ï´½ïµ-ï¶ï¶’-ï·‡ï·°-ï·»ï¹°-ï¹´ï¹¶-ï»¼ï¼¡-ï¼ºï½-ï½šï½¦-ï¾¾ï¿‚-ï¿‡ï¿Š-ï¿ï¿’-ï¿—ï¿š-ï¿œð€€-ð€‹ð€-ð€¦ð€¨-ð€ºð€¼ð€½ð€¿-ðð-ðð‚€-ðƒºðŠ€-ðŠœðŠ -ð‹ðŒ€-ðŒŸðŒ­-ð€ð‚-ð‰ð-ðµðŽ€-ðŽðŽ -ðƒðˆ-ðð€-ð’ð’°-ð““ð“˜-ð“»ð”€-ð”§ð”°-ð•£\U00010570-\U0001057a\U0001057c-\U0001058a\U0001058c-\U00010592\U00010594\U00010595\U00010597-\U000105a1\U000105a3-\U000105b1\U000105b3-\U000105b9\U000105bb\U000105bcð˜€-ðœ¶ð€-ð•ð -ð§\U00010780-\U00010785\U00010787-\U000107b0\U000107b2-\U000107bað €-ð …ð ˆð Š-ð µð ·ð ¸ð ¼ð ¿-ð¡•ð¡ -ð¡¶ð¢€-ð¢žð£ -ð£²ð£´ð£µð¤€-ð¤•ð¤ -ð¤¹ð¦€-ð¦·ð¦¾ð¦¿ð¨€ð¨-ð¨“ð¨•-ð¨—ð¨™-ð¨µð© -ð©¼ðª€-ðªœð«€-ð«‡ð«‰-ð«¤ð¬€-ð¬µð­€-ð­•ð­ -ð­²ð®€-ð®‘ð°€-ð±ˆð²€-ð²²ð³€-ð³²ð´€-ð´£ðº€-ðº©ðº°ðº±ð¼€-ð¼œð¼§ð¼°-ð½…\U00010f70-\U00010f81ð¾°-ð¿„ð¿ -ð¿¶ð‘€ƒ-ð‘€·\U00011071\U00011072\U00011075ð‘‚ƒ-ð‘‚¯ð‘ƒ-ð‘ƒ¨ð‘„ƒ-ð‘„¦ð‘…„ð‘…‡ð‘…-ð‘…²ð‘…¶ð‘†ƒ-ð‘†²ð‘‡-ð‘‡„ð‘‡šð‘‡œð‘ˆ€-ð‘ˆ‘ð‘ˆ“-ð‘ˆ«\U0001123f\U00011240ð‘Š€-ð‘Š†ð‘Šˆð‘ŠŠ-ð‘Šð‘Š-ð‘Šð‘ŠŸ-ð‘Š¨ð‘Š°-ð‘‹žð‘Œ…-ð‘ŒŒð‘Œð‘Œð‘Œ“-ð‘Œ¨ð‘Œª-ð‘Œ°ð‘Œ²ð‘Œ³ð‘Œµ-ð‘Œ¹ð‘Œ½ð‘ð‘-ð‘¡ð‘€-ð‘´ð‘‘‡-ð‘‘Šð‘‘Ÿ-ð‘‘¡ð‘’€-ð‘’¯ð‘“„ð‘“…ð‘“‡ð‘–€-ð‘–®ð‘—˜-ð‘—›ð‘˜€-ð‘˜¯ð‘™„ð‘š€-ð‘šªð‘š¸ð‘œ€-ð‘œš\U00011740-\U00011746ð‘ €-ð‘ «ð‘¢ -ð‘£Ÿð‘£¿-ð‘¤†ð‘¤‰ð‘¤Œ-ð‘¤“ð‘¤•ð‘¤–ð‘¤˜-ð‘¤¯ð‘¤¿ð‘¥ð‘¦ -ð‘¦§ð‘¦ª-ð‘§ð‘§¡ð‘§£ð‘¨€ð‘¨‹-ð‘¨²ð‘¨ºð‘©ð‘©œ-ð‘ª‰ð‘ª\U00011ab0-ð‘«¸ð‘°€-ð‘°ˆð‘°Š-ð‘°®ð‘±€ð‘±²-ð‘²ð‘´€-ð‘´†ð‘´ˆð‘´‰ð‘´‹-ð‘´°ð‘µ†ð‘µ -ð‘µ¥ð‘µ§ð‘µ¨ð‘µª-ð‘¶‰ð‘¶˜ð‘» -ð‘»²\U00011f02\U00011f04-\U00011f10\U00011f12-\U00011f33ð‘¾°ð’€€-ð’Ž™ð’’€-ð’•ƒ\U00012f90-\U00012ff0ð“€€-\U0001342f\U00013441-\U00013446ð”€-ð”™†ð– €-ð–¨¸ð–©€-ð–©ž\U00016a70-\U00016abeð–«-ð–«­ð–¬€-ð–¬¯ð–­€-ð–­ƒð–­£-ð–­·ð–­½-ð–®ð–¹€-ð–¹¿ð–¼€-ð–½Šð–½ð–¾“-ð–¾Ÿð–¿ ð–¿¡ð–¿£ð—€€-ð˜Ÿ·ð˜ €-ð˜³•ð˜´€-ð˜´ˆ\U0001aff0-\U0001aff3\U0001aff5-\U0001affb\U0001affd\U0001affeð›€€-\U0001b122\U0001b132ð›…-ð›…’\U0001b155ð›…¤-ð›…§ð›…°-ð›‹»ð›°€-ð›±ªð›±°-ð›±¼ð›²€-ð›²ˆð›²-ð›²™ð€-ð‘”ð‘–-ð’œð’žð’Ÿð’¢ð’¥ð’¦ð’©-ð’¬ð’®-ð’¹ð’»ð’½-ð“ƒð“…-ð”…ð”‡-ð”Šð”-ð””ð”–-ð”œð”ž-ð”¹ð”»-ð”¾ð•€-ð•„ð•†ð•Š-ð•ð•’-ðš¥ðš¨-ð›€ð›‚-ð›šð›œ-ð›ºð›¼-ðœ”ðœ–-ðœ´ðœ¶-ðŽð-ð®ð°-ðžˆðžŠ-ðž¨ðžª-ðŸ‚ðŸ„-ðŸ‹\U0001df00-\U0001df1e\U0001df25-\U0001df2a\U0001e030-\U0001e06dðž„€-ðž„¬ðž„·-ðž„½ðž…Ž\U0001e290-\U0001e2adðž‹€-ðž‹«\U0001e4d0-\U0001e4eb\U0001e7e0-\U0001e7e6\U0001e7e8-\U0001e7eb\U0001e7ed\U0001e7ee\U0001e7f0-\U0001e7feðž €-ðž£„ðž¤€-ðž¥ƒðž¥‹ðž¸€-ðž¸ƒðž¸…-ðž¸Ÿðž¸¡ðž¸¢ðž¸¤ðž¸§ðž¸©-ðž¸²ðž¸´-ðž¸·ðž¸¹ðž¸»ðž¹‚ðž¹‡ðž¹‰ðž¹‹ðž¹-ðž¹ðž¹‘ðž¹’ðž¹”ðž¹—ðž¹™ðž¹›ðž¹ðž¹Ÿðž¹¡ðž¹¢ðž¹¤ðž¹§-ðž¹ªðž¹¬-ðž¹²ðž¹´-ðž¹·ðž¹¹-ðž¹¼ðž¹¾ðžº€-ðžº‰ðžº‹-ðžº›ðžº¡-ðžº£ðžº¥-ðžº©ðžº«-ðžº»ð €€-\U0002a6dfðªœ€-\U0002b739ð«€-ð« ð«  -ð¬º¡ð¬º°-ð®¯ ð¯ €-ð¯¨ð°€€-ð±Š\U00031350-\U000323af]|[0-9Â²Â³Â¹Â¼-Â¾Ù -Ù©Û°-Û¹ß€-ß‰à¥¦-à¥¯à§¦-à§¯à§´-à§¹à©¦-à©¯à«¦-à«¯à­¦-à­¯à­²-à­·à¯¦-à¯²à±¦-à±¯à±¸-à±¾à³¦-à³¯àµ˜-àµžàµ¦-àµ¸à·¦-à·¯à¹-à¹™à»-à»™à¼ -à¼³á€-á‰á‚-á‚™á©-á¼á›®-á›°áŸ -áŸ©áŸ°-áŸ¹á -á ™á¥†-á¥á§-á§šáª€-áª‰áª-áª™á­-á­™á®°-á®¹á±€-á±‰á±-á±™â°â´-â¹â‚€-â‚‰â…-â†‚â†…-â†‰â‘ -â’›â“ª-â“¿â¶-âž“â³½ã€‡ã€¡-ã€©ã€¸-ã€ºã†’-ã†•ãˆ -ãˆ©ã‰ˆ-ã‰ã‰‘-ã‰ŸãŠ€-ãŠ‰ãŠ±-ãŠ¿ê˜ -ê˜©ê›¦-ê›¯ê °-ê µê£-ê£™ê¤€-ê¤‰ê§-ê§™ê§°-ê§¹ê©-ê©™ê¯°-ê¯¹ï¼-ï¼™ð„‡-ð„³ð…€-ð…¸ð†Šð†‹ð‹¡-ð‹»ðŒ -ðŒ£ððŠð‘-ð•ð’ -ð’©ð¡˜-ð¡Ÿð¡¹-ð¡¿ð¢§-ð¢¯ð£»-ð£¿ð¤–-ð¤›ð¦¼ð¦½ð§€-ð§ð§’-ð§¿ð©€-ð©ˆð©½ð©¾ðª-ðªŸð««-ð«¯ð­˜-ð­Ÿð­¸-ð­¿ð®©-ð®¯ð³º-ð³¿ð´°-ð´¹ð¹ -ð¹¾ð¼-ð¼¦ð½‘-ð½”ð¿…-ð¿‹ð‘’-ð‘¯ð‘ƒ°-ð‘ƒ¹ð‘„¶-ð‘„¿ð‘‡-ð‘‡™ð‘‡¡-ð‘‡´ð‘‹°-ð‘‹¹ð‘‘-ð‘‘™ð‘“-ð‘“™ð‘™-ð‘™™ð‘›€-ð‘›‰ð‘œ°-ð‘œ»ð‘£ -ð‘£²ð‘¥-ð‘¥™ð‘±-ð‘±¬ð‘µ-ð‘µ™ð‘¶ -ð‘¶©\U00011f50-\U00011f59ð‘¿€-ð‘¿”ð’€-ð’‘®ð–© -ð–©©\U00016ac0-\U00016ac9ð–­-ð–­™ð–­›-ð–­¡ð–º€-ð–º–\U0001d2c0-\U0001d2d3ð‹ -ð‹³ð -ð¸ðŸŽ-ðŸ¿ðž…€-ðž…‰ðž‹°-ðž‹¹\U0001e4f0-\U0001e4f9ðž£‡-ðž£ðž¥-ðž¥™ðž±±-ðž²«ðž²­-ðž²¯ðž²±-ðž²´ðž´-ðž´­ðž´¯-ðž´½ðŸ„€-ðŸ„ŒðŸ¯°-ðŸ¯¹]|_)@([a-z](?:_(?!_)|[a-z0-9]){2,30}[a-z0-9]|gif|pic|vid)(?![A-Za-zÂªÂµÂºÃ€-Ã–Ã˜-Ã¶Ã¸-ËË†-Ë‘Ë -Ë¤Ë¬Ë®Í°-Í´Í¶Í·Íº-Í½Í¿Î†Îˆ-ÎŠÎŒÎŽ-Î¡Î£-ÏµÏ·-ÒÒŠ-Ô¯Ô±-Õ–Õ™Õ -Öˆ×-×ª×¯-×²Ø -ÙŠÙ®Ù¯Ù±-Û“Û•Û¥Û¦Û®Û¯Ûº-Û¼Û¿ÜÜ’-Ü¯Ý-Þ¥Þ±ßŠ-ßªß´ßµßºà €-à •à šà ¤à ¨à¡€-à¡˜à¡ -à¡ª\u0870-\u0887\u0889-\u088eà¢ -\u08c9à¤„-à¤¹à¤½à¥à¥˜-à¥¡à¥±-à¦€à¦…-à¦Œà¦à¦à¦“-à¦¨à¦ª-à¦°à¦²à¦¶-à¦¹à¦½à§Žà§œà§à§Ÿ-à§¡à§°à§±à§¼à¨…-à¨Šà¨à¨à¨“-à¨¨à¨ª-à¨°à¨²à¨³à¨µà¨¶à¨¸à¨¹à©™-à©œà©žà©²-à©´àª…-àªàª-àª‘àª“-àª¨àªª-àª°àª²àª³àªµ-àª¹àª½à«à« à«¡à«¹à¬…-à¬Œà¬à¬à¬“-à¬¨à¬ª-à¬°à¬²à¬³à¬µ-à¬¹à¬½à­œà­à­Ÿ-à­¡à­±à®ƒà®…-à®Šà®Ž-à®à®’-à®•à®™à®šà®œà®žà®Ÿà®£à®¤à®¨-à®ªà®®-à®¹à¯à°…-à°Œà°Ž-à°à°’-à°¨à°ª-à°¹à°½à±˜-à±š\u0c5dà± à±¡à²€à²…-à²Œà²Ž-à²à²’-à²¨à²ª-à²³à²µ-à²¹à²½\u0cddà³žà³ à³¡à³±à³²à´„-à´Œà´Ž-à´à´’-à´ºà´½àµŽàµ”-àµ–àµŸ-àµ¡àµº-àµ¿à¶…-à¶–à¶š-à¶±à¶³-à¶»à¶½à·€-à·†à¸-à¸°à¸²à¸³à¹€-à¹†àºàº‚àº„àº†-àºŠàºŒ-àº£àº¥àº§-àº°àº²àº³àº½à»€-à»„à»†à»œ-à»Ÿà¼€à½€-à½‡à½‰-à½¬à¾ˆ-à¾Œá€€-á€ªá€¿á-á•áš-áá¡á¥á¦á®-á°áµ-á‚á‚Žá‚ -áƒ…áƒ‡áƒáƒ-áƒºáƒ¼-á‰ˆá‰Š-á‰á‰-á‰–á‰˜á‰š-á‰á‰ -áŠˆáŠŠ-áŠáŠ-áŠ°áŠ²-áŠµáŠ¸-áŠ¾á‹€á‹‚-á‹…á‹ˆ-á‹–á‹˜-áŒáŒ’-áŒ•áŒ˜-ášáŽ€-áŽáŽ -áµá¸-á½á-á™¬á™¯-á™¿áš-áššáš -á›ªá›±-á›¸áœ€-áœ‘\u171f-áœ±á€-á‘á -á¬á®-á°áž€-áž³áŸ—áŸœá  -á¡¸á¢€-á¢„á¢‡-á¢¨á¢ªá¢°-á£µá¤€-á¤žá¥-á¥­á¥°-á¥´á¦€-á¦«á¦°-á§‰á¨€-á¨–á¨ -á©”áª§á¬…-á¬³á­…-\u1b4cá®ƒ-á® á®®á®¯á®º-á¯¥á°€-á°£á±-á±á±š-á±½á²€-á²ˆá²-á²ºá²½-á²¿á³©-á³¬á³®-á³³á³µá³¶á³ºá´€-á¶¿á¸€-á¼•á¼˜-á¼á¼ -á½…á½ˆ-á½á½-á½—á½™á½›á½á½Ÿ-á½½á¾€-á¾´á¾¶-á¾¼á¾¾á¿‚-á¿„á¿†-á¿Œá¿-á¿“á¿–-á¿›á¿ -á¿¬á¿²-á¿´á¿¶-á¿¼â±â¿â‚-â‚œâ„‚â„‡â„Š-â„“â„•â„™-â„â„¤â„¦â„¨â„ª-â„­â„¯-â„¹â„¼-â„¿â……-â…‰â…Žâ†ƒâ†„â°€-â³¤â³«-â³®â³²â³³â´€-â´¥â´§â´­â´°-âµ§âµ¯â¶€-â¶–â¶ -â¶¦â¶¨-â¶®â¶°-â¶¶â¶¸-â¶¾â·€-â·†â·ˆ-â·Žâ·-â·–â·˜-â·žâ¸¯ã€…ã€†ã€±-ã€µã€»ã€¼ã-ã‚–ã‚-ã‚Ÿã‚¡-ãƒºãƒ¼-ãƒ¿ã„…-ã„¯ã„±-ã†Žã† -ã†¿ã‡°-ã‡¿ã€-ä¶¿ä¸€-ê’Œê“-ê“½ê”€-ê˜Œê˜-ê˜Ÿê˜ªê˜«ê™€-ê™®ê™¿-êšêš -ê›¥êœ—-êœŸêœ¢-êžˆêž‹-êŸŠ\ua7d0\ua7d1\ua7d3\ua7d5-\ua7d9\ua7f2-ê ê ƒ-ê …ê ‡-ê Šê Œ-ê ¢ê¡€-ê¡³ê¢‚-ê¢³ê£²-ê£·ê£»ê£½ê£¾ê¤Š-ê¤¥ê¤°-ê¥†ê¥ -ê¥¼ê¦„-ê¦²ê§ê§ -ê§¤ê§¦-ê§¯ê§º-ê§¾ê¨€-ê¨¨ê©€-ê©‚ê©„-ê©‹ê© -ê©¶ê©ºê©¾-êª¯êª±êªµêª¶êª¹-êª½ê«€ê«‚ê«›-ê«ê« -ê«ªê«²-ê«´ê¬-ê¬†ê¬‰-ê¬Žê¬‘-ê¬–ê¬ -ê¬¦ê¬¨-ê¬®ê¬°-ê­šê­œ-ê­©ê­°-ê¯¢ê°€-íž£íž°-íŸ†íŸ‹-íŸ»ï¤€-ï©­ï©°-ï«™ï¬€-ï¬†ï¬“-ï¬—ï¬ï¬Ÿ-ï¬¨ï¬ª-ï¬¶ï¬¸-ï¬¼ï¬¾ï­€ï­ï­ƒï­„ï­†-ï®±ï¯“-ï´½ïµ-ï¶ï¶’-ï·‡ï·°-ï·»ï¹°-ï¹´ï¹¶-ï»¼ï¼¡-ï¼ºï½-ï½šï½¦-ï¾¾ï¿‚-ï¿‡ï¿Š-ï¿ï¿’-ï¿—ï¿š-ï¿œð€€-ð€‹ð€-ð€¦ð€¨-ð€ºð€¼ð€½ð€¿-ðð-ðð‚€-ðƒºðŠ€-ðŠœðŠ -ð‹ðŒ€-ðŒŸðŒ­-ð€ð‚-ð‰ð-ðµðŽ€-ðŽðŽ -ðƒðˆ-ðð€-ð’ð’°-ð““ð“˜-ð“»ð”€-ð”§ð”°-ð•£\U00010570-\U0001057a\U0001057c-\U0001058a\U0001058c-\U00010592\U00010594\U00010595\U00010597-\U000105a1\U000105a3-\U000105b1\U000105b3-\U000105b9\U000105bb\U000105bcð˜€-ðœ¶ð€-ð•ð -ð§\U00010780-\U00010785\U00010787-\U000107b0\U000107b2-\U000107bað €-ð …ð ˆð Š-ð µð ·ð ¸ð ¼ð ¿-ð¡•ð¡ -ð¡¶ð¢€-ð¢žð£ -ð£²ð£´ð£µð¤€-ð¤•ð¤ -ð¤¹ð¦€-ð¦·ð¦¾ð¦¿ð¨€ð¨-ð¨“ð¨•-ð¨—ð¨™-ð¨µð© -ð©¼ðª€-ðªœð«€-ð«‡ð«‰-ð«¤ð¬€-ð¬µð­€-ð­•ð­ -ð­²ð®€-ð®‘ð°€-ð±ˆð²€-ð²²ð³€-ð³²ð´€-ð´£ðº€-ðº©ðº°ðº±ð¼€-ð¼œð¼§ð¼°-ð½…\U00010f70-\U00010f81ð¾°-ð¿„ð¿ -ð¿¶ð‘€ƒ-ð‘€·\U00011071\U00011072\U00011075ð‘‚ƒ-ð‘‚¯ð‘ƒ-ð‘ƒ¨ð‘„ƒ-ð‘„¦ð‘…„ð‘…‡ð‘…-ð‘…²ð‘…¶ð‘†ƒ-ð‘†²ð‘‡-ð‘‡„ð‘‡šð‘‡œð‘ˆ€-ð‘ˆ‘ð‘ˆ“-ð‘ˆ«\U0001123f\U00011240ð‘Š€-ð‘Š†ð‘Šˆð‘ŠŠ-ð‘Šð‘Š-ð‘Šð‘ŠŸ-ð‘Š¨ð‘Š°-ð‘‹žð‘Œ…-ð‘ŒŒð‘Œð‘Œð‘Œ“-ð‘Œ¨ð‘Œª-ð‘Œ°ð‘Œ²ð‘Œ³ð‘Œµ-ð‘Œ¹ð‘Œ½ð‘ð‘-ð‘¡ð‘€-ð‘´ð‘‘‡-ð‘‘Šð‘‘Ÿ-ð‘‘¡ð‘’€-ð‘’¯ð‘“„ð‘“…ð‘“‡ð‘–€-ð‘–®ð‘—˜-ð‘—›ð‘˜€-ð‘˜¯ð‘™„ð‘š€-ð‘šªð‘š¸ð‘œ€-ð‘œš\U00011740-\U00011746ð‘ €-ð‘ «ð‘¢ -ð‘£Ÿð‘£¿-ð‘¤†ð‘¤‰ð‘¤Œ-ð‘¤“ð‘¤•ð‘¤–ð‘¤˜-ð‘¤¯ð‘¤¿ð‘¥ð‘¦ -ð‘¦§ð‘¦ª-ð‘§ð‘§¡ð‘§£ð‘¨€ð‘¨‹-ð‘¨²ð‘¨ºð‘©ð‘©œ-ð‘ª‰ð‘ª\U00011ab0-ð‘«¸ð‘°€-ð‘°ˆð‘°Š-ð‘°®ð‘±€ð‘±²-ð‘²ð‘´€-ð‘´†ð‘´ˆð‘´‰ð‘´‹-ð‘´°ð‘µ†ð‘µ -ð‘µ¥ð‘µ§ð‘µ¨ð‘µª-ð‘¶‰ð‘¶˜ð‘» -ð‘»²\U00011f02\U00011f04-\U00011f10\U00011f12-\U00011f33ð‘¾°ð’€€-ð’Ž™ð’’€-ð’•ƒ\U00012f90-\U00012ff0ð“€€-\U0001342f\U00013441-\U00013446ð”€-ð”™†ð– €-ð–¨¸ð–©€-ð–©ž\U00016a70-\U00016abeð–«-ð–«­ð–¬€-ð–¬¯ð–­€-ð–­ƒð–­£-ð–­·ð–­½-ð–®ð–¹€-ð–¹¿ð–¼€-ð–½Šð–½ð–¾“-ð–¾Ÿð–¿ ð–¿¡ð–¿£ð—€€-ð˜Ÿ·ð˜ €-ð˜³•ð˜´€-ð˜´ˆ\U0001aff0-\U0001aff3\U0001aff5-\U0001affb\U0001affd\U0001affeð›€€-\U0001b122\U0001b132ð›…-ð›…’\U0001b155ð›…¤-ð›…§ð›…°-ð›‹»ð›°€-ð›±ªð›±°-ð›±¼ð›²€-ð›²ˆð›²-ð›²™ð€-ð‘”ð‘–-ð’œð’žð’Ÿð’¢ð’¥ð’¦ð’©-ð’¬ð’®-ð’¹ð’»ð’½-ð“ƒð“…-ð”…ð”‡-ð”Šð”-ð””ð”–-ð”œð”ž-ð”¹ð”»-ð”¾ð•€-ð•„ð•†ð•Š-ð•ð•’-ðš¥ðš¨-ð›€ð›‚-ð›šð›œ-ð›ºð›¼-ðœ”ðœ–-ðœ´ðœ¶-ðŽð-ð®ð°-ðžˆðžŠ-ðž¨ðžª-ðŸ‚ðŸ„-ðŸ‹\U0001df00-\U0001df1e\U0001df25-\U0001df2a\U0001e030-\U0001e06dðž„€-ðž„¬ðž„·-ðž„½ðž…Ž\U0001e290-\U0001e2adðž‹€-ðž‹«\U0001e4d0-\U0001e4eb\U0001e7e0-\U0001e7e6\U0001e7e8-\U0001e7eb\U0001e7ed\U0001e7ee\U0001e7f0-\U0001e7feðž €-ðž£„ðž¤€-ðž¥ƒðž¥‹ðž¸€-ðž¸ƒðž¸…-ðž¸Ÿðž¸¡ðž¸¢ðž¸¤ðž¸§ðž¸©-ðž¸²ðž¸´-ðž¸·ðž¸¹ðž¸»ðž¹‚ðž¹‡ðž¹‰ðž¹‹ðž¹-ðž¹ðž¹‘ðž¹’ðž¹”ðž¹—ðž¹™ðž¹›ðž¹ðž¹Ÿðž¹¡ðž¹¢ðž¹¤ðž¹§-ðž¹ªðž¹¬-ðž¹²ðž¹´-ðž¹·ðž¹¹-ðž¹¼ðž¹¾ðžº€-ðžº‰ðžº‹-ðžº›ðžº¡-ðžº£ðžº¥-ðžº©ðžº«-ðžº»ð €€-\U0002a6dfðªœ€-\U0002b739ð«€-ð« ð«  -ð¬º¡ð¬º°-ð®¯ ð¯ €-ð¯¨ð°€€-ð±Š\U00031350-\U000323af]|[0-9Â²Â³Â¹Â¼-Â¾Ù -Ù©Û°-Û¹ß€-ß‰à¥¦-à¥¯à§¦-à§¯à§´-à§¹à©¦-à©¯à«¦-à«¯à­¦-à­¯à­²-à­·à¯¦-à¯²à±¦-à±¯à±¸-à±¾à³¦-à³¯àµ˜-àµžàµ¦-àµ¸à·¦-à·¯à¹-à¹™à»-à»™à¼ -à¼³á€-á‰á‚-á‚™á©-á¼á›®-á›°áŸ -áŸ©áŸ°-áŸ¹á -á ™á¥†-á¥á§-á§šáª€-áª‰áª-áª™á­-á­™á®°-á®¹á±€-á±‰á±-á±™â°â´-â¹â‚€-â‚‰â…-â†‚â†…-â†‰â‘ -â’›â“ª-â“¿â¶-âž“â³½ã€‡ã€¡-ã€©ã€¸-ã€ºã†’-ã†•ãˆ -ãˆ©ã‰ˆ-ã‰ã‰‘-ã‰ŸãŠ€-ãŠ‰ãŠ±-ãŠ¿ê˜ -ê˜©ê›¦-ê›¯ê °-ê µê£-ê£™ê¤€-ê¤‰ê§-ê§™ê§°-ê§¹ê©-ê©™ê¯°-ê¯¹ï¼-ï¼™ð„‡-ð„³ð…€-ð…¸ð†Šð†‹ð‹¡-ð‹»ðŒ -ðŒ£ððŠð‘-ð•ð’ -ð’©ð¡˜-ð¡Ÿð¡¹-ð¡¿ð¢§-ð¢¯ð£»-ð£¿ð¤–-ð¤›ð¦¼ð¦½ð§€-ð§ð§’-ð§¿ð©€-ð©ˆð©½ð©¾ðª-ðªŸð««-ð«¯ð­˜-ð­Ÿð­¸-ð­¿ð®©-ð®¯ð³º-ð³¿ð´°-ð´¹ð¹ -ð¹¾ð¼-ð¼¦ð½‘-ð½”ð¿…-ð¿‹ð‘’-ð‘¯ð‘ƒ°-ð‘ƒ¹ð‘„¶-ð‘„¿ð‘‡-ð‘‡™ð‘‡¡-ð‘‡´ð‘‹°-ð‘‹¹ð‘‘-ð‘‘™ð‘“-ð‘“™ð‘™-ð‘™™ð‘›€-ð‘›‰ð‘œ°-ð‘œ»ð‘£ -ð‘£²ð‘¥-ð‘¥™ð‘±-ð‘±¬ð‘µ-ð‘µ™ð‘¶ -ð‘¶©\U00011f50-\U00011f59ð‘¿€-ð‘¿”ð’€-ð’‘®ð–© -ð–©©\U00016ac0-\U00016ac9ð–­-ð–­™ð–­›-ð–­¡ð–º€-ð–º–\U0001d2c0-\U0001d2d3ð‹ -ð‹³ð -ð¸ðŸŽ-ðŸ¿ðž…€-ðž…‰ðž‹°-ðž‹¹\U0001e4f0-\U0001e4f9ðž£‡-ðž£ðž¥-ðž¥™ðž±±-ðž²«ðž²­-ðž²¯ðž²±-ðž²´ðž´-ðž´­ðž´¯-ðž´½ðŸ„€-ðŸ„ŒðŸ¯°-ðŸ¯¹]|_)', re.I)


logger = logging.getLogger(__name__)


class Backend(ABC):
    def _setup_logging(self, name=None):
        full_name = type(self).__module__
        if name:
            full_name += "." + name
        self.logger = logging.getLogger(full_name)

    @classmethod
    @abstractmethod
    def get_instances(cls, common_config, configs):
        """Return an iterable of instances that implement Backend"""

    async def init(self):
        """Initialise the class"""

    async def close(self):
        """Prepare for destruction, this may be called multiple times"""


class JoinedUsersGetterBackend(Backend):
    @abstractmethod
    async def get_joined_users(self):
        """Fetch the users in the group, returning an iterable"""


class BioLinksGetterBackend(Backend):
    @abstractmethod
    async def get_bio_links(self, uid, username):
        """Return an iterable of usernames present in the bio, excluding the @"""

class BioTextGetterBackend(BioLinksGetterBackend):
    @abstractmethod
    async def get_bio_text(self, uid, username):
        """Return the user's bio text"""

    async def get_bio_links(self, uid, username):
        """Return an iterable of usernames present in the bio, excluding the @"""
        return [x.group()[1:] for x in USERNAME_REGEX.finditer(await self.get_bio_text(uid, username))]



class Unavailable(RuntimeError):
    def __init__(self, message, seconds=0, retry_elsewhere=False):
        super().__init__(message)
        self.seconds = seconds
        self.retry_elsewhere = retry_elsewhere


class Broken(RuntimeError):
    pass
